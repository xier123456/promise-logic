promise-logic介绍文档
发布于2026-01-21 01:10:35
最后编辑：2026-01-21 01:11:56
PromiseLogic
用逻辑门语义组合 Promise - 忘记 API，记住逻辑。

PromiseLogic 是一个全面的实用工具库，为 Promise 组合提供直观的逻辑门语义。它扩展了标准 Promise API，添加了与数字电路设计相呼应的逻辑操作，使异步编程更加直观和表达性强。

核心理念
"忘记 API，记住逻辑。" - 用跨所有异步操作一致工作的基础逻辑概念，替代零散的 API 知识。

功能特性
完整的逻辑门语义: AND（与）、OR（或）、XOR（异或）、NAND（与非）、NOR（或非）、XNOR（同或）、Majority（多数决）
扩展的 Promise 操作: 所有成功/拒绝结果、完整的结算分析
双重 API 模式: 静态类方法 + 可配置的工厂函数
生产就绪: 零依赖、完整的 TypeScript 支持
测试驱动: 100% 测试覆盖率，包含全面的边界情况
树摇优化: 针对现代构建系统优化的打包输出
安装
Bash

复制
npm install promise-logic
快速开始
基础逻辑门
Javascript

复制
import { PromiseLogic } from 'promise-logic';

// AND 逻辑 - 所有 Promise 必须成功（等同于 Promise.all）
const results = await PromiseLogic.and([
  fetch('/api/users'),
  fetch('/api/posts'),
  fetch('/api/comments')
]);

// OR 逻辑 - 任意 Promise 成功（在首次成功时短路）
const data = await PromiseLogic.or([
  fetchPrimaryService(),
  fetchBackupService()
]);

// XOR 逻辑 - 必须有且仅有一个 Promise 成功
const uniqueResult = await PromiseLogic.xor([
  cacheLookup(),
  databaseQuery()
]);
高级逻辑操作
Javascript

复制
// NAND 逻辑 - 并非所有 Promise 都成功（至少一个失败）
const hasFailures = await PromiseLogic.nand([
  validateInput(),
  checkPermissions(),
  verifyResources()
]);

// NOR 逻辑 - 所有 Promise 必须失败
const allFailed = await PromiseLogic.nor([
  experimentalFeature(),
  deprecatedAPI()
]);

// Majority 逻辑 - 超过半数成功
const consensus = await PromiseLogic.majority([
  server1.query(),
  server2.query(),
  server3.query()
]);
扩展结果分析
Javascript

复制
// 仅获取成功结果
const successes = await PromiseLogic.allFulfilled([
  apiCall1(),
  apiCall2(),
  apiCall3()
]);

// 仅获取失败原因
const failures = await PromiseLogic.allRejected([
  riskyOperation1(),
  riskyOperation2()
]);

// 获取完整的结算信息
const allResults = await PromiseLogic.allResults([
  operation1(),
  operation2()
]);

// 严格的全成功验证
const allSuccessful = await PromiseLogic.allSuccessful([
  validation1(),
  validation2(),
  validation3()
]);

// 严格的全失败验证
const allFailed = await PromiseLogic.allFailed([
  deprecatedCall1(),
  deprecatedCall2()
]);
API 参考
核心逻辑门
PromiseLogic.and(iterable)
等同于 Promise.all。当所有 Promise 完成时解析，如果有任何 Promise 拒绝则拒绝。

PromiseLogic.or(iterable)
解析为第一个成功的 Promise。仅当所有 Promise 都拒绝时才拒绝。

PromiseLogic.xor(iterable)
当有且仅有一个 Promise 完成时解析。如果零个或多个 Promise 完成则拒绝。

PromiseLogic.nand(iterable)
当并非所有 Promise 都完成时（至少一个拒绝）解析。如果所有 Promise 都完成则拒绝。

PromiseLogic.nor(iterable)
当所有 Promise 都拒绝时解析。如果有任何 Promise 完成则拒绝。

PromiseLogic.xnor(iterable)
当所有 Promise 都完成或都拒绝时解析。在混合情况下拒绝。

PromiseLogic.majority(iterable)
当超过半数的 Promise 完成时解析。否则拒绝。

扩展操作
PromiseLogic.allFulfilled(iterable)
始终解析为一个已完成值的数组（如果没有则为空数组）。

PromiseLogic.allRejected(iterable)
始终解析为一个拒绝原因的数组（如果没有则为空数组）。

PromiseLogic.allResults(iterable)
等同于 Promise.allSettled。返回完整的结算信息。

PromiseLogic.allSuccessful(iterable)
仅当每个 Promise 都完成时解析所有值。否则拒绝。

PromiseLogic.allFailed(iterable)
仅当每个 Promise 都拒绝时解析所有拒绝原因。否则拒绝。

实用方法
PromiseLogic.race(iterable)
等同于 Promise.race。解析或拒绝为第一个结算的 Promise。

PromiseLogic.allSettled(iterable)
等同于 Promise.allSettled。始终解析为结算结果。

PromiseLogic.createFlipFlop(initialState?)
创建一个有状态的触发器实用工具，用于管理布尔状态转换。

工厂函数
使用方法名转换创建自定义实例：

Javascript

复制
import { createPromiseLogic } from 'promise-logic';

// 默认命名
const logic = createPromiseLogic();
await logic.and([promise1, promise2]);

// 带前缀
const asyncLogic = createPromiseLogic({ prefix: 'async' });
await asyncLogic.asyncand([promise1, promise2]);

// 带后缀
const logicUtils = createPromiseLogic({ suffix: 'Logic' });
await logicUtils.andLogic([promise1, promise2]);

// 自定义重命名
const customLogic = createPromiseLogic({
  rename: {
    and: 'conjunction',
    or: 'disjunction',
    xor: 'exclusiveOr'
  }
});
await customLogic.conjunction([promise1, promise2]);

// 组合转换
const advancedLogic = createPromiseLogic({
  prefix: 'async',
  suffix: 'Logic',
  rename: { and: 'conjunction' }
});
await advancedLogic.asyncconjunctionLogic([promise1, promise2]);
实际应用示例
服务编排
Javascript

复制
// 带后备的负载均衡
const userData = await PromiseLogic.or([
  primaryUserService.getUser(id),
  secondaryUserService.getUser(id),
  cacheService.getUser(id)
]);

// 多步骤验证
const isValid = await PromiseLogic.and([
  validateEmail(email),
  validatePassword(password),
  checkRateLimit(ipAddress)
]);

// 基于共识的决策
const configuration = await PromiseLogic.majority([
  configServer1.getConfig(),
  configServer2.getConfig(),
  configServer3.getConfig()
]);
错误恢复与分析
Javascript

复制
// 优雅降级
const [successfulResults, failedOperations] = await Promise.all([
  PromiseLogic.allFulfilled(operations),
  PromiseLogic.allRejected(operations)
]);

// 全面的错误报告
const results = await PromiseLogic.allResults(operations);
const successful = results.filter(r => r.status === 'fulfilled');
const failed = results.filter(r => r.status === 'rejected');

console.log(`操作结果: ${successful.length} 成功, ${failed.length} 失败`);
状态管理
Javascript

复制
// 用于切换操作的触发器
const toggle = PromiseLogic.createFlipFlop(false);

// 切换状态并等待变更
await toggle.toggle();
console.log(toggle.getState()); // true

// 设置特定状态
await toggle.setState(false);
错误处理
所有逻辑门都抛出带有描述性消息的 PromiseLogicError：

Javascript

复制
try {
  await PromiseLogic.xor([apiCall1(), apiCall2()]);
} catch (error) {
  if (error.type === 'XOR_ERROR') {
    console.log('期望有且仅有一个调用成功');
  }
  console.log('失败的 Promise:', error.results);
}
TypeScript 支持
具有精确类型推断的完整 TypeScript 支持：

Typescript

复制
import { PromiseLogic } from 'promise-logic';

// 成功结果的类型推断
const numbers: number[] = await PromiseLogic.and([
  Promise.resolve(1),
  Promise.resolve(2),
  Promise.resolve(3)
]);

// 类型安全的错误处理
try {
  await PromiseLogic.nand(operations);
} catch (error: PromiseLogicError) {
  // error 包含完整的类型信息
}
高级用法
自定义逻辑组合
Javascript

复制
// 创建复杂的逻辑流
async function advancedOperation(promises) {
  const [successes, failures] = await Promise.all([
    PromiseLogic.allFulfilled(promises),
    PromiseLogic.allRejected(promises)
  ]);

  if (successes.length >= failures.length) {
    return { data: successes, warnings: failures };
  } else {
    throw new Error('操作大部分失败');
  }
}
性能优化
Javascript

复制
// 使用逻辑门进行批处理
const batches = chunkArray(operations, BATCH_SIZE);
const batchResults = await PromiseLogic.allFulfilled(
  batches.map(batch => PromiseLogic.and(batch))
);

// 展平结果
const allResults = batchResults.flat();
贡献指南
我们欢迎贡献！详情请参阅我们的贡献指南。

许可证
MIT 许可证 - 详见 LICENSE 文件。

相关链接
GitHub 仓库: https://github.com/xier123456/promise-logic
npm 包: https://www.npmjs.com/package/promise-logic
主页 ： https://promise-logic-1a6v.vercel.app/
问题跟踪: https://github.com/xier123456/promise-logic/issues
PromiseLogic - 让异步逻辑如同数字电路般简单。